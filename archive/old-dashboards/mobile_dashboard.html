<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>DFS Mobile Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
        min-height: 100vh;
        color: white;
        padding: 10px;
        touch-action: manipulation;
      }

      .mobile-container {
        max-width: 480px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .mobile-header {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .mobile-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .mobile-subtitle {
        opacity: 0.9;
        font-size: 0.9rem;
      }

      .card-mobile {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        padding: 20px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .card-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: #fff;
      }

      .contest-stack {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .contest-card-mobile {
        background: rgba(0, 0, 0, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .contest-card-mobile:active {
        transform: scale(0.98);
      }

      .contest-card-mobile.selected {
        border-color: #10b981;
        background: rgba(16, 185, 129, 0.2);
      }

      .contest-name-mobile {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
      }

      .contest-details-mobile {
        opacity: 0.8;
        font-size: 0.85rem;
      }

      .big-button {
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        border-radius: 50px;
        padding: 20px;
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .big-button:active {
        transform: scale(0.95);
      }

      .big-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .settings-mobile {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .setting-label {
        font-weight: 500;
        font-size: 1rem;
      }

      .setting-input {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 12px 16px;
        color: white;
        font-size: 1rem;
        width: 100px;
        text-align: center;
      }

      .setting-input:focus {
        outline: none;
        border-color: #10b981;
        box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
      }

      .player-list-mobile {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 400px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .player-card-mobile {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-height: 50px;
      }

      .player-info {
        flex: 1;
      }

      .player-name {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 2px;
      }

      .player-details {
        opacity: 0.8;
        font-size: 0.8rem;
      }

      .player-stats {
        text-align: right;
        flex-shrink: 0;
      }

      .player-projection {
        font-weight: 600;
        color: #10b981;
        font-size: 0.9rem;
      }

      .player-salary {
        opacity: 0.8;
        font-size: 0.8rem;
      }

      .lineup-stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 350px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      .lineup-card-mobile {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 15px;
        border-left: 4px solid #10b981;
      }

      .lineup-header-mobile {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .lineup-number {
        font-weight: 600;
        color: #10b981;
      }

      .lineup-score {
        font-weight: 700;
        font-size: 1.1rem;
      }

      .lineup-players-mobile {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
        font-size: 0.8rem;
      }

      .status-bar {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status-item {
        text-align: center;
      }

      .status-value {
        font-weight: 600;
        font-size: 1rem;
        color: #10b981;
      }

      .status-label {
        font-size: 0.75rem;
        opacity: 0.8;
        margin-top: 2px;
      }

      .loading-mobile {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px;
        gap: 15px;
      }

      .spinner-mobile {
        width: 32px;
        height: 32px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .swipe-hint {
        text-align: center;
        opacity: 0.6;
        font-size: 0.8rem;
        margin-top: 10px;
      }

      /* Touch-friendly improvements */
      .contest-card-mobile,
      .big-button,
      .player-card-mobile {
        min-height: 44px; /* iOS accessibility guideline */
      }

      .setting-input,
      button {
        min-height: 44px;
      }

      /* iOS safe area */
      @supports (padding: env(safe-area-inset-top)) {
        .mobile-container {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }
    </style>
  </head>
  <body>
    <div class="mobile-container">
      <!-- Header -->
      <div class="mobile-header">
        <div class="mobile-title">‚ö° DFS Mobile</div>
        <div class="mobile-subtitle">Daily Fantasy Optimizer</div>
      </div>

      <!-- Status Bar -->
      <div class="status-bar">
        <div class="status-item">
          <div class="status-value" id="api-status-mobile">‚óè</div>
          <div class="status-label">API</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="contest-count-mobile">0</div>
          <div class="status-label">Contests</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="player-count-mobile">0</div>
          <div class="status-label">Players</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="lineup-count-mobile">0</div>
          <div class="status-label">Lineups</div>
        </div>
      </div>

      <!-- Contest Selection -->
      <div class="card-mobile">
        <div class="card-title">üìã Select Contest</div>
        <div class="contest-stack" id="contest-stack">
          <div class="loading-mobile">
            <div class="spinner-mobile"></div>
            <div>Loading contests...</div>
          </div>
        </div>
      </div>

      <!-- Optimization Settings -->
      <div class="card-mobile">
        <div class="card-title">‚öôÔ∏è Settings</div>
        <div class="settings-mobile">
          <div class="setting-row">
            <span class="setting-label">Lineups</span>
            <input
              type="number"
              id="lineups-mobile"
              value="20"
              min="1"
              max="150"
              class="setting-input"
            />
          </div>
          <div class="setting-row">
            <span class="setting-label">Uniqueness</span>
            <input
              type="number"
              id="uniqueness-mobile"
              value="6"
              min="1"
              max="9"
              class="setting-input"
            />
          </div>
        </div>
      </div>

      <!-- Optimize Button -->
      <button class="big-button" id="optimize-mobile" onclick="runMobileOptimization()">
        <span>üöÄ</span>
        <span>Generate Lineups</span>
      </button>

      <!-- Player Pool -->
      <div class="card-mobile" id="player-section" style="display: none">
        <div class="card-title">üë• Top Players</div>
        <div class="player-list-mobile" id="player-list-mobile">
          <div class="loading-mobile">
            <div class="spinner-mobile"></div>
            <div>Loading players...</div>
          </div>
        </div>
        <div class="swipe-hint">‚Üê Swipe to see more players ‚Üí</div>
      </div>

      <!-- Results -->
      <div class="card-mobile" id="results-section" style="display: none">
        <div class="card-title">üéØ Generated Lineups</div>
        <div class="lineup-stack" id="lineup-stack">
          <div style="text-align: center; opacity: 0.7; padding: 30px">
            Run optimization to see lineups
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = 'http://localhost:8001/api';
      const API_KEY = 'dfs-demo-key';
      let selectedSlateId = null;
      let currentPlayers = [];

      async function fetchWithAuth(url, options = {}) {
        return fetch(url, {
          ...options,
          headers: {
            'X-API-Key': API_KEY,
            'Content-Type': 'application/json',
            ...options.headers,
          },
        });
      }

      async function loadContestsMobile() {
        try {
          const response = await fetchWithAuth(`${API_BASE}/slates`);
          const data = await response.json();

          const contestStack = document.getElementById('contest-stack');

          if (data.slates && data.slates.length > 0) {
            document.getElementById('contest-count-mobile').textContent =
              data.slates.length;
            contestStack.innerHTML = data.slates
              .map(
                slate => `
                        <div class="contest-card-mobile" data-slate-id="${slate.id}" onclick="selectContestMobile('${slate.id}', this)">
                            <div class="contest-name-mobile">${slate.name}</div>
                            <div class="contest-details-mobile">
                                ${slate.playerCount || 0} players ‚Ä¢ $${(slate.salaryCap || 50000).toLocaleString()} salary cap
                            </div>
                        </div>
                    `
              )
              .join('');
          } else {
            // Fallback demo data
            document.getElementById('contest-count-mobile').textContent = '2';
            contestStack.innerHTML = `
                        <div class="contest-card-mobile" data-slate-id="demo-1" onclick="selectContestMobile('demo-1', this)">
                            <div class="contest-name-mobile">üèà NFL Week 3 - Main Slate</div>
                            <div class="contest-details-mobile">247 players ‚Ä¢ $50,000 salary cap</div>
                        </div>
                        <div class="contest-card-mobile" data-slate-id="demo-2" onclick="selectContestMobile('demo-2', this)">
                            <div class="contest-name-mobile">üåô Thursday Night Football</div>
                            <div class="contest-details-mobile">18 players ‚Ä¢ $50,000 salary cap</div>
                        </div>
                    `;
          }
        } catch (error) {
          document.getElementById('contest-stack').innerHTML =
            '<div style="text-align: center; opacity: 0.7; padding: 20px;">Unable to load contests</div>';
        }
      }

      function selectContestMobile(slateId, element) {
        document
          .querySelectorAll('.contest-card-mobile')
          .forEach(card => card.classList.remove('selected'));
        element.classList.add('selected');

        selectedSlateId = slateId;

        // Haptic feedback (if supported)
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }

        loadPlayersMobile(slateId);

        // Show player section
        document.getElementById('player-section').style.display = 'block';

        // Smooth scroll to player section
        setTimeout(() => {
          document.getElementById('player-section').scrollIntoView({
            behavior: 'smooth',
            block: 'start',
          });
        }, 100);
      }

      async function loadPlayersMobile(slateId) {
        const playerList = document.getElementById('player-list-mobile');
        playerList.innerHTML =
          '<div class="loading-mobile"><div class="spinner-mobile"></div><div>Loading players...</div></div>';

        try {
          const response = await fetchWithAuth(`${API_BASE}/slates/${slateId}/players`);
          const data = await response.json();

          if (data.players && data.players.length > 0) {
            currentPlayers = data.players;
            document.getElementById('player-count-mobile').textContent =
              data.players.length;

            playerList.innerHTML = data.players
              .slice(0, 20)
              .map(player => {
                const value = (player.projection * 1000) / player.salary || 0;
                const valueColor =
                  value >= 2.5 ? '#10b981' : value >= 2.0 ? '#f59e0b' : '#ef4444';

                return `
                            <div class="player-card-mobile">
                                <div class="player-info">
                                    <div class="player-name">${player.display_name || player.name}</div>
                                    <div class="player-details">
                                        ${player.position} ‚Ä¢ ${player.team_abbreviation || player.team} ‚Ä¢ 
                                        ${((player.ownership || 0) * 100).toFixed(1)}% owned
                                    </div>
                                </div>
                                <div class="player-stats">
                                    <div class="player-projection">${(player.projection || 0).toFixed(1)} pts</div>
                                    <div class="player-salary">$${(player.salary || 0).toLocaleString()}</div>
                                    <div style="color: ${valueColor}; font-size: 0.8rem; font-weight: 500;">
                                        ${value.toFixed(2)}x value
                                    </div>
                                </div>
                            </div>
                        `;
              })
              .join('');
          } else {
            playerList.innerHTML =
              '<div style="text-align: center; opacity: 0.7; padding: 30px;">No players available</div>';
          }
        } catch (error) {
          playerList.innerHTML =
            '<div style="text-align: center; color: #ef4444; padding: 30px;">Error loading players</div>';
        }
      }

      async function runMobileOptimization() {
        if (!selectedSlateId || !currentPlayers.length) {
          // Show mobile-friendly alert
          if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
          alert('Please select a contest first!');
          return;
        }

        const btn = document.getElementById('optimize-mobile');
        btn.disabled = true;
        btn.innerHTML = '<span>üîÑ</span><span>Optimizing...</span>';

        // Show results section
        const resultsSection = document.getElementById('results-section');
        resultsSection.style.display = 'block';

        const lineupStack = document.getElementById('lineup-stack');
        lineupStack.innerHTML =
          '<div class="loading-mobile"><div class="spinner-mobile"></div><div>Generating lineups...</div></div>';

        try {
          const optimizationRequest = {
            slateId: selectedSlateId,
            players: currentPlayers.slice(0, 50),
            constraints: {
              numLineups:
                parseInt(document.getElementById('lineups-mobile').value) || 20,
              salaryCapMode: 'hard',
              salaryCap: 50000,
              uniquePlayers:
                parseInt(document.getElementById('uniqueness-mobile').value) || 6,
              minSalary: 49000,
              maxSalary: 50000,
            },
          };

          const response = await fetchWithAuth(`${API_BASE}/optimize`, {
            method: 'POST',
            body: JSON.stringify(optimizationRequest),
          });

          const result = await response.json();

          if (result.lineups && result.lineups.length > 0) {
            document.getElementById('lineup-count-mobile').textContent =
              result.lineups.length;

            lineupStack.innerHTML = result.lineups
              .slice(0, 10)
              .map(
                (lineup, index) => `
                        <div class="lineup-card-mobile">
                            <div class="lineup-header-mobile">
                                <span class="lineup-number">Lineup ${index + 1}</span>
                                <span class="lineup-score">${lineup.projectedScore?.toFixed(1) || '140.0'} pts</span>
                            </div>
                            <div style="font-size: 0.85rem; margin-bottom: 8px; opacity: 0.8;">
                                üí∞ $${lineup.totalSalary?.toLocaleString() || '50,000'} ‚Ä¢ 
                                üìà ${lineup.roi?.toFixed(0) || '15'}% ROI
                            </div>
                            <div class="lineup-players-mobile">
                                ${
                                  lineup.players
                                    ?.slice(0, 9)
                                    .map(
                                      player => `
                                    <div style="display: flex; justify-content: space-between; padding: 1px 0;">
                                        <span>${(player.playerName || player.name || '').substring(0, 10)}</span>
                                        <span style="opacity: 0.7;">${player.projectedPoints?.toFixed(1) || '15.0'}</span>
                                    </div>
                                `
                                    )
                                    .join('') || ''
                                }
                            </div>
                        </div>
                    `
              )
              .join('');

            // Haptic feedback for success
            if (navigator.vibrate) navigator.vibrate(200);

            // Scroll to results
            setTimeout(() => {
              resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 500);
          } else {
            lineupStack.innerHTML =
              '<div style="text-align: center; opacity: 0.7; padding: 30px;">No lineups generated</div>';
          }
        } catch (error) {
          lineupStack.innerHTML =
            '<div style="text-align: center; color: #ef4444; padding: 30px;">Optimization failed</div>';
          if (navigator.vibrate) navigator.vibrate([100, 100, 100]);
        } finally {
          btn.disabled = false;
          btn.innerHTML = '<span>üöÄ</span><span>Generate Lineups</span>';
        }
      }

      async function checkApiHealthMobile() {
        try {
          const response = await fetchWithAuth(`${API_BASE}/healthz`);
          const health = await response.json();

          if (health.ok || response.ok) {
            document.getElementById('api-status-mobile').textContent = '‚óè';
            document.getElementById('api-status-mobile').style.color = '#10b981';
          } else {
            throw new Error('API not healthy');
          }
        } catch (error) {
          document.getElementById('api-status-mobile').textContent = '‚óè';
          document.getElementById('api-status-mobile').style.color = '#ef4444';
        }
      }

      // Initialize mobile app
      window.addEventListener('DOMContentLoaded', () => {
        loadContestsMobile();
        checkApiHealthMobile();

        // Auto-refresh every 30 seconds
        setInterval(checkApiHealthMobile, 30000);

        // Add touch event listeners for better mobile experience
        document.addEventListener('touchstart', function () {}, true);
      });

      // Handle orientation changes
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          // Recalculate layout after orientation change
          window.scrollTo(0, 0);
        }, 100);
      });
    </script>
  </body>
</html>
