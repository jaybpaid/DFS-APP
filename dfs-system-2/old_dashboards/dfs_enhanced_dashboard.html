<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DFS Optimizer Pro - Live Slate Data</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.4/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --dk-blue: #53d337;
        --fd-blue: #1e3a8a;
        --primary: #2563eb;
        --secondary: #059669;
        --accent: #f59e0b;
        --dark: #0f172a;
        --light: #f8fafc;
      }

      body {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        font-family: 'Inter', system-ui, sans-serif;
      }

      /* Enhanced Header with Slate Info */
      .main-header {
        background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
        color: white;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 0 0 24px 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .slate-info-bar {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1rem;
        margin-top: 1rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
      }

      .slate-stat {
        text-align: center;
        padding: 0.5rem;
      }

      .slate-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dk-blue);
      }

      .slate-stat-label {
        font-size: 0.8rem;
        opacity: 0.8;
      }

      /* Contest Cards */
      .contest-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .contest-card {
        background: white;
        border-radius: 16px;
        border: 2px solid transparent;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .contest-card.dk {
        border-color: var(--dk-blue);
      }

      .contest-card.fd {
        border-color: var(--fd-blue);
      }

      .contest-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }

      .contest-header {
        padding: 1rem;
        font-weight: 700;
        color: white;
      }

      .contest-header.dk {
        background: linear-gradient(135deg, var(--dk-blue), #22c55e);
      }

      .contest-header.fd {
        background: linear-gradient(135deg, var(--fd-blue), #3b82f6);
      }

      .contest-body {
        padding: 1rem;
      }

      /* Multi-Source Data Display */
      .data-sources {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid #e5e7eb;
      }

      .source-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }

      .source-tab {
        background: #f1f5f9;
        border: 1px solid #d1d5db;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        font-size: 0.8rem;
      }

      .source-tab.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .source-content {
        background: #f8fafc;
        border-radius: 12px;
        padding: 1rem;
        min-height: 120px;
      }

      /* Enhanced Player Cards */
      .player-enhanced-card {
        background: white;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        padding: 1rem;
        margin-bottom: 0.8rem;
        transition: all 0.3s;
        position: relative;
      }

      .player-enhanced-card:hover {
        border-color: var(--primary);
        box-shadow: 0 4px 16px rgba(37, 99, 235, 0.15);
      }

      .player-enhanced-card.locked {
        border-color: var(--secondary);
        background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      }

      .player-enhanced-card.banned {
        border-color: #ef4444;
        background: linear-gradient(135deg, #fef2f2, #fee2e2);
      }

      .multi-source-indicator {
        position: absolute;
        top: 8px;
        right: 8px;
        background: var(--accent);
        color: white;
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 0.7rem;
        font-weight: 600;
      }

      /* Advanced Projections Display */
      .projection-breakdown {
        background: #f0f9ff;
        border-radius: 8px;
        padding: 0.5rem;
        margin-top: 0.5rem;
        border: 1px solid rgba(37, 99, 235, 0.2);
      }

      .projection-item {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        margin-bottom: 2px;
      }

      .projection-item:last-child {
        margin-bottom: 0;
      }

      /* Responsive Grid */
      .enhanced-grid {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 2rem;
      }

      @media (max-width: 1200px) {
        .enhanced-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Enhanced Header with Live Slate Info -->
    <div class="main-header">
      <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="mb-0">
              <i class="fas fa-satellite-dish me-2"></i>DFS Optimizer Pro
            </h1>
            <p class="mb-0 opacity-75">Live Slate Data from Multiple Sources</p>
          </div>
          <div class="d-flex gap-3">
            <div class="sport-pill active" data-sport="NFL">üèà NFL</div>
            <div class="sport-pill" data-sport="NBA">üèÄ NBA</div>
          </div>
        </div>

        <!-- Live Slate Information Bar -->
        <div class="slate-info-bar" id="slateInfoBar">
          <div class="slate-stat">
            <div class="slate-stat-value" id="totalGames">0</div>
            <div class="slate-stat-label">Games</div>
          </div>
          <div class="slate-stat">
            <div class="slate-stat-value" id="totalPlayers">0</div>
            <div class="slate-stat-label">Players</div>
          </div>
          <div class="slate-stat">
            <div class="slate-stat-value" id="avgSalary">$0</div>
            <div class="slate-stat-label">Avg Salary</div>
          </div>
          <div class="slate-stat">
            <div class="slate-stat-value" id="sourcesScraped">0</div>
            <div class="slate-stat-label">Sources</div>
          </div>
          <div class="slate-stat">
            <div class="slate-stat-value" id="lastUpdated">--</div>
            <div class="slate-stat-label">Last Update</div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <!-- Alert Area -->
      <div id="alertArea"></div>

      <!-- Contest Information -->
      <div class="contest-grid" id="contestGrid">
        <!-- Contests will be populated here -->
      </div>

      <!-- Multi-Source Data Panel -->
      <div class="data-sources">
        <h4><i class="fas fa-database me-2"></i>Multi-Source Intelligence</h4>
        <div class="source-tabs" id="sourceTabs">
          <div class="source-tab active" data-source="rotogrinders">RotoGrinders</div>
          <div class="source-tab" data-source="sabersim">SaberSim</div>
          <div class="source-tab" data-source="stokastic">Stokastic</div>
          <div class="source-tab" data-source="pff">PFF</div>
          <div class="source-tab" data-source="dfs_army">DFS Army</div>
          <div class="source-tab" data-source="ai_analysis">AI Analysis</div>
        </div>
        <div class="source-content" id="sourceContent">
          <div class="text-muted">
            <i class="fas fa-spinner fa-spin me-2"></i>Loading multi-source data...
          </div>
        </div>
      </div>

      <!-- Main Dashboard -->
      <div class="enhanced-grid">
        <!-- Player Pool with Enhanced Data -->
        <div>
          <div class="card">
            <div class="card-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                <span><i class="fas fa-users me-2"></i>Enhanced Player Pool</span>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-light btn-sm" id="scrapeSlateBtn">
                    <i class="fas fa-sync-alt"></i> Refresh Slate
                  </button>
                  <button class="btn btn-light btn-sm" id="loadLiveBtn">
                    <i class="fas fa-satellite-dish"></i> Live Data
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div id="enhancedPlayersContainer">
                <div class="text-center py-5">
                  <i class="fas fa-satellite-dish fa-4x mb-3 text-primary"></i>
                  <h4>Loading Live Slate Data...</h4>
                  <p class="text-muted">
                    Scraping DraftKings, FanDuel, and analysis sites
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Panel - AI + Controls -->
        <div>
          <!-- AI Assistant with Multi-Provider -->
          <div class="card mb-3">
            <div class="card-header bg-success text-white">
              <i class="fas fa-brain me-2"></i>AI Multi-Source Analysis
            </div>
            <div class="card-body">
              <div class="ai-providers mb-3">
                <div class="btn-group w-100" role="group">
                  <input
                    type="radio"
                    class="btn-check"
                    name="aiProvider"
                    id="chatgpt"
                    value="chatgpt"
                    checked
                  />
                  <label class="btn btn-outline-primary btn-sm" for="chatgpt"
                    >GPT-4</label
                  >

                  <input
                    type="radio"
                    class="btn-check"
                    name="aiProvider"
                    id="gemini"
                    value="gemini"
                  />
                  <label class="btn btn-outline-primary btn-sm" for="gemini"
                    >Gemini</label
                  >

                  <input
                    type="radio"
                    class="btn-check"
                    name="aiProvider"
                    id="deepseek"
                    value="deepseek"
                  />
                  <label class="btn btn-outline-primary btn-sm" for="deepseek"
                    >DeepSeek</label
                  >
                </div>
              </div>

              <div
                class="ai-response-area p-3 bg-light rounded"
                id="aiResponseArea"
                style="min-height: 120px"
              >
                <div class="text-muted">
                  <i class="fas fa-robot fa-2x mb-2"></i><br />
                  <strong>AI Assistant Ready</strong><br />
                  Click "Get Analysis" for slate insights
                </div>
              </div>

              <button class="btn btn-primary w-100 mt-2" id="getAIAnalysisBtn">
                <i class="fas fa-brain"></i> Get AI Analysis
              </button>
            </div>
          </div>

          <!-- Optimization with Live Data -->
          <div class="card mb-3">
            <div class="card-header bg-warning text-dark">
              <i class="fas fa-cogs me-2"></i>Live Optimization
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-6">
                  <label class="form-label">Lineups</label>
                  <input
                    type="number"
                    id="numLineups"
                    class="form-control"
                    value="5"
                    min="1"
                    max="100"
                  />
                </div>
                <div class="col-6">
                  <label class="form-label">Strategy</label>
                  <select id="strategy" class="form-select">
                    <option value="cash">Cash Game</option>
                    <option value="gpp">Tournament</option>
                    <option value="hybrid">Hybrid</option>
                  </select>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Use Multi-Source Data</label>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="useRotoGrinders"
                    checked
                  />
                  <label class="form-check-label">RotoGrinders Ownership</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="useSaberSim"
                    checked
                  />
                  <label class="form-check-label">SaberSim Projections</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="usePFF" checked />
                  <label class="form-check-label">PFF Analytics</label>
                </div>
              </div>

              <button class="btn btn-success w-100 btn-lg" id="optimizeWithDataBtn">
                <i class="fas fa-rocket"></i> Optimize with Live Data
              </button>
            </div>
          </div>

          <!-- Live Contests -->
          <div class="card">
            <div class="card-header bg-info text-white">
              <i class="fas fa-trophy me-2"></i>Live Contests
            </div>
            <div class="card-body p-2">
              <div id="liveContestsContainer">
                <div class="text-center py-3">
                  <i class="fas fa-satellite-dish fa-2x mb-2 text-info"></i>
                  <p class="mb-0 text-muted">Loading contest data...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Lineups Display -->
      <div class="card mt-3">
        <div class="card-header bg-success text-white">
          <div class="d-flex justify-content-between align-items-center">
            <span
              ><i class="fas fa-list-ol me-2"></i>Generated Lineups with Multi-Source
              Data</span
            >
            <button class="btn btn-light btn-sm" id="exportEnhancedBtn">
              <i class="fas fa-download"></i> Export Enhanced
            </button>
          </div>
        </div>
        <div class="card-body">
          <div id="enhancedLineupsContainer">
            <div class="text-center py-5">
              <i class="fas fa-magic fa-3x mb-3 text-muted"></i>
              <h5 class="text-muted">
                Optimize with live data to see enhanced lineups
              </h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.4/js/dataTables.bootstrap5.min.js"></script>

    <script>
      let enhancedState = {
        sport: 'NFL',
        site: 'DraftKings',
        slateData: {},
        players: [],
        lineups: [],
        currentSource: 'rotogrinders',
        aiProvider: 'chatgpt',
      };

      $(document).ready(function () {
        setupEventListeners();
        loadLiveSlateData();
        showAlert('success', 'üöÄ Enhanced Dashboard with Live Multi-Source Data!');
      });

      function setupEventListeners() {
        // Sport selection
        $('.sport-pill').click(function () {
          $('.sport-pill').removeClass('active');
          $(this).addClass('active');
          const sport = $(this).data('sport');
          switchSportWithLiveData(sport);
        });

        // Source tabs
        $('.source-tab').click(function () {
          $('.source-tab').removeClass('active');
          $(this).addClass('active');
          const source = $(this).data('source');
          displaySourceData(source);
        });

        // Buttons
        $('#scrapeSlateBtn').click(loadLiveSlateData);
        $('#loadLiveBtn').click(loadLiveSlateData);
        $('#getAIAnalysisBtn').click(getEnhancedAIAnalysis);
        $('#optimizeWithDataBtn').click(optimizeWithLiveData);
        $('#exportEnhancedBtn').click(exportEnhancedLineups);

        // AI provider selection
        $('input[name="aiProvider"]').change(function () {
          enhancedState.aiProvider = $(this).val();
        });
      }

      function switchSportWithLiveData(sport) {
        enhancedState.sport = sport;
        enhancedState.site = sport === 'NBA' ? 'FanDuel' : 'DraftKings';

        showLoading(`Switching to ${sport} - Loading live slate data...`);
        setTimeout(() => {
          loadLiveSlateData();
        }, 1000);
      }

      async function loadLiveSlateData() {
        const sport = enhancedState.sport;
        showLoading(`üï∑Ô∏è Scraping live ${sport} data from multiple sources...`);

        // Simulate comprehensive scraping
        const mockSlateData = {
          sport: sport,
          scraped_at: new Date().toISOString(),
          sources: {
            draftkings: { success: true, contests: 25, players: 450 },
            fanduel: { success: true, contests: 18, players: 420 },
            rotogrinders: { success: true, ownership_data: true },
            sabersim: { success: true, projections: 380 },
            stokastic: { success: true, projections: 350 },
            pff: { success: true, analytics: 280 },
            dfs_army: { success: true, tools: true },
          },
          contests: generateLiveContests(sport),
          players: generateEnhancedPlayers(sport),
          slate_info: {
            games_count: sport === 'NFL' ? 16 : 12,
            total_players: sport === 'NFL' ? 480 : 360,
            avg_salary: sport === 'NFL' ? 6250 : 7500,
            main_slate_start: '1:00 PM ET',
            weather_games: sport === 'NFL' ? ['BUF@MIA', 'GB@CHI'] : [],
            high_total_games: ['KC@LAC', 'DAL@NYG'],
          },
        };

        enhancedState.slateData = mockSlateData;
        enhancedState.players = mockSlateData.players;

        // Update UI
        updateSlateInfoBar(mockSlateData);
        displayContests(mockSlateData.contests);
        displayEnhancedPlayers(mockSlateData.players);
        displaySourceData('rotogrinders');

        setTimeout(() => {
          hideLoading();
          showAlert('success', `‚úÖ Live ${sport} slate data loaded from 7 sources!`);
        }, 2500);
      }

      function generateLiveContests(sport) {
        if (sport === 'NFL') {
          return [
            {
              site: 'DraftKings',
              name: 'NFL Millionaire Maker',
              entry_fee: '$20',
              prize_pool: '$4M',
              entries: '180K/200K',
              salary_cap: '$50K',
              start_time: '1:00 PM ET',
            },
            {
              site: 'DraftKings',
              name: 'NFL Main Slate',
              entry_fee: '$1',
              prize_pool: '$50K',
              entries: '12.5K/15K',
              salary_cap: '$50K',
              start_time: '1:00 PM ET',
            },
            {
              site: 'FanDuel',
              name: 'NFL Sunday Million',
              entry_fee: '$9',
              prize_pool: '$1M',
              entries: '125K/150K',
              salary_cap: '$60K',
              start_time: '1:00 PM ET',
            },
          ];
        } else {
          return [
            {
              site: 'DraftKings',
              name: 'NBA Shot Caller',
              entry_fee: '$27',
              prize_pool: '$400K',
              entries: '15K/17K',
              salary_cap: '$50K',
              start_time: '7:00 PM ET',
            },
            {
              site: 'FanDuel',
              name: 'NBA Fast Break',
              entry_fee: '$5',
              prize_pool: '$80K',
              entries: '18K/20K',
              salary_cap: '$60K',
              start_time: '7:00 PM ET',
            },
          ];
        }
      }

      function generateEnhancedPlayers(sport) {
        // Enhanced player data with multi-source information
        const baseData =
          sport === 'NFL'
            ? [
                {
                  name: 'Josh Allen',
                  position: 'QB',
                  team: 'BUF',
                  salary: 8900,
                  opponent: 'MIA',
                },
                {
                  name: 'Christian McCaffrey',
                  position: 'RB',
                  team: 'SF',
                  salary: 9200,
                  opponent: 'LAR',
                },
                {
                  name: 'Tyreek Hill',
                  position: 'WR',
                  team: 'MIA',
                  salary: 8200,
                  opponent: 'BUF',
                },
                {
                  name: 'Travis Kelce',
                  position: 'TE',
                  team: 'KC',
                  salary: 7400,
                  opponent: 'LAC',
                },
                {
                  name: 'Saquon Barkley',
                  position: 'RB',
                  team: 'PHI',
                  salary: 8800,
                  opponent: 'WAS',
                },
                {
                  name: 'Davante Adams',
                  position: 'WR',
                  team: 'LVR',
                  salary: 8400,
                  opponent: 'DEN',
                },
              ]
            : [
                {
                  name: 'Luka Doncic',
                  position: 'PG',
                  team: 'DAL',
                  salary: 11500,
                  opponent: 'LAL',
                },
                {
                  name: 'Nikola Jokic',
                  position: 'C',
                  team: 'DEN',
                  salary: 11000,
                  opponent: 'GSW',
                },
                {
                  name: 'Giannis',
                  position: 'PF',
                  team: 'MIL',
                  salary: 10800,
                  opponent: 'BOS',
                },
                {
                  name: 'Stephen Curry',
                  position: 'PG',
                  team: 'GSW',
                  salary: 9800,
                  opponent: 'DEN',
                },
              ];

        return baseData.map(p => ({
          ...p,
          id: p.name.replace(/\s+/g, '').toLowerCase(),

          // Multi-source projections
          rg_projection: Math.round(Math.random() * 8 + 12),
          sabersim_projection: Math.round(Math.random() * 8 + 14),
          stokastic_projection: Math.round(Math.random() * 8 + 13),

          // Ownership from different sources
          rg_ownership: Math.round(Math.random() * 30 + 5),
          sabersim_ownership: Math.round(Math.random() * 25 + 8),

          // Advanced metrics
          pff_grade: Math.round(Math.random() * 20 + 70),
          target_share: Math.round(Math.random() * 15 + 10),
          snap_count: Math.round(Math.random() * 30 + 50),

          // Calculated fields
          consensus_projection: Math.round(Math.random() * 8 + 15),
          value: Math.round(((Math.random() * 8 + 15) / (p.salary / 1000)) * 100) / 100,
          locked: false,
          banned: false,

          // Multi-source indicator
          sources_count: Math.floor(Math.random() * 3) + 4, // 4-6 sources
        }));
      }

      function updateSlateInfoBar(slateData) {
        $('#totalGames').text(slateData.slate_info.games_count);
        $('#totalPlayers').text(slateData.slate_info.total_players);
        $('#avgSalary').text(
          `$${(slateData.slate_info.avg_salary / 1000).toFixed(1)}K`
        );
        $('#sourcesScraped').text(Object.keys(slateData.sources).length);
        $('#lastUpdated').text(new Date().toLocaleTimeString());
      }

      function displayContests(contests) {
        const container = $('#contestGrid');
        container.empty();

        contests.forEach(contest => {
          const siteClass = contest.site === 'DraftKings' ? 'dk' : 'fd';
          const contestCard = $(`
                    <div class="contest-card ${siteClass}">
                        <div class="contest-header ${siteClass}">
                            <div class="d-flex justify-content-between">
                                <span>${contest.site}</span>
                                <span>${contest.start_time}</span>
                            </div>
                            <h6 class="mb-0 mt-1">${contest.name}</h6>
                        </div>
                        <div class="contest-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <strong>${contest.entry_fee}</strong><br>
                                    <small class="text-muted">Entry</small>
                                </div>
                                <div class="col-6">
                                    <strong>${contest.prize_pool}</strong><br>
                                    <small class="text-muted">Prizes</small>
                                </div>
                            </div>
                            <div class="row text-center mt-2">
                                <div class="col-6">
                                    <strong>${contest.entries}</strong><br>
                                    <small class="text-muted">Entries</small>
                                </div>
                                <div class="col-6">
                                    <strong>${contest.salary_cap}</strong><br>
                                    <small class="text-muted">Cap</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
          container.append(contestCard);
        });
      }

      function displayEnhancedPlayers(players) {
        const container = $('#enhancedPlayersContainer');
        container.empty();

        players.forEach(player => {
          const valueColor =
            player.value >= 4.5
              ? 'var(--secondary)'
              : player.value >= 3.5
                ? 'var(--accent)'
                : '#6b7280';

          const cardClass = player.locked
            ? 'player-enhanced-card locked'
            : player.banned
              ? 'player-enhanced-card banned'
              : 'player-enhanced-card';

          const playerCard = $(`
                    <div class="${cardClass}" data-player-id="${player.id}">
                        <div class="multi-source-indicator">${player.sources_count} sources</div>
                        
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-1 fw-bold">${player.name}</h6>
                                <div>
                                    <span class="badge me-1" style="background: var(--primary); color: white;">${player.position}</span>
                                    <span class="badge" style="background: var(--secondary); color: white;">${player.team}</span>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold">$${(player.salary / 1000).toFixed(1)}K</div>
                                <div class="small" style="color: ${valueColor};">Val: ${player.value}</div>
                            </div>
                        </div>
                        
                        <div class="projection-breakdown">
                            <div class="projection-item">
                                <span>Consensus:</span>
                                <strong>${player.consensus_projection}</strong>
                            </div>
                            <div class="projection-item">
                                <span>RG Own:</span>
                                <span>${player.rg_ownership}%</span>
                            </div>
                            <div class="projection-item">
                                <span>PFF Grade:</span>
                                <span>${player.pff_grade}</span>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <div class="btn-group btn-group-sm">
                                <button class="btn ${player.locked ? 'btn-success' : 'btn-outline-success'} lock-btn" data-player-id="${player.id}">
                                    <i class="fas fa-lock"></i>
                                </button>
                                <button class="btn ${player.banned ? 'btn-danger' : 'btn-outline-danger'} ban-btn" data-player-id="${player.id}">
                                    <i class="fas fa-ban"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline-primary btn-sm player-analysis-btn" data-player-id="${player.id}">
                                <i class="fas fa-chart-line"></i> Analysis
                            </button>
                        </div>
                    </div>
                `);

          container.append(playerCard);
        });

        // Add event handlers
        $('.lock-btn').click(function () {
          const playerId = $(this).data('player-id');
          togglePlayerLock(playerId);
        });

        $('.ban-btn').click(function () {
          const playerId = $(this).data('player-id');
          togglePlayerBan(playerId);
        });

        $('.player-analysis-btn').click(function () {
          const playerId = $(this).data('player-id');
          showPlayerAnalysis(playerId);
        });
      }

      function displaySourceData(source) {
        enhancedState.currentSource = source;
        const container = $('#sourceContent');

        const sourceData = {
          rotogrinders: `
                    <h6><i class="fas fa-chart-pie me-2"></i>RotoGrinders Ownership Data</h6>
                    <div class="row">
                        <div class="col-6"><strong>High Owned:</strong><br>Josh Allen (22.5%)<br>CMC (35.2%)</div>
                        <div class="col-6"><strong>Low Owned:</strong><br>Kyren Williams (8.1%)<br>Tank Dell (6.4%)</div>
                    </div>
                `,
          sabersim: `
                    <h6><i class="fas fa-calculator me-2"></i>SaberSim Advanced Projections</h6>
                    <div class="row">
                        <div class="col-6"><strong>Top Ceiling:</strong><br>Josh Allen (35.4)<br>Tyreek Hill (28.9)</div>
                        <div class="col-6"><strong>High Floor:</strong><br>CMC (12.3)<br>Saquon (11.8)</div>
                    </div>
                `,
          stokastic: `
                    <h6><i class="fas fa-target me-2"></i>Stokastic Projections</h6>
                    <div class="row">
                        <div class="col-6"><strong>High Confidence:</strong><br>CMC (92%)<br>Josh Allen (85%)</div>
                        <div class="col-6"><strong>Value Plays:</strong><br>Saquon (19.4)<br>CeeDee (17.6)</div>
                    </div>
                `,
          pff: `
                    <h6><i class="fas fa-chart-bar me-2"></i>PFF Analytics</h6>
                    <div class="row">
                        <div class="col-6"><strong>Top Grades:</strong><br>CMC (94.1)<br>Josh Allen (91.2)</div>
                        <div class="col-6"><strong>Target Share:</strong><br>CeeDee (26.8%)<br>Tyreek (24.2%)</div>
                    </div>
                `,
          dfs_army: `
                    <h6><i class="fas fa-shield-alt me-2"></i>DFS Army Strategy</h6>
                    <div class="row">
                        <div class="col-6"><strong>GPP Build:</strong><br>QB-stud, RB-value<br>WR-ceiling, TE-floor</div>
                        <div class="col-6"><strong>Cash Build:</strong><br>High floor players<br>Consistent WRs</div>
                    </div>
                `,
          ai_analysis: `
                    <h6><i class="fas fa-brain me-2"></i>AI Multi-Source Analysis</h6>
                    <div class="ai-summary">
                        <strong>üéØ Key Insights:</strong><br>
                        ‚Ä¢ Stack correlation plays for upside<br>
                        ‚Ä¢ Target 4.5+ value with ownership leverage<br>
                        ‚Ä¢ Weather impact in BUF@MIA game
                    </div>
                `,
        };

        container.html(
          sourceData[source] || '<div class="text-muted">Loading data...</div>'
        );
      }

      function getEnhancedAIAnalysis() {
        if (enhancedState.players.length === 0) {
          showAlert('warning', 'Load slate data first');
          return;
        }

        const provider = enhancedState.aiProvider;
        const sport = enhancedState.sport;

        showLoading(`Getting ${provider.toUpperCase()} analysis...`);

        // Enhanced AI analysis with multi-source data
        const analyses = {
          chatgpt: `
                    <div class="ai-analysis">
                        <h6><i class="fas fa-brain me-2" style="color: #10a37f;"></i>ChatGPT Analysis</h6>
                        <p><strong>Multi-Source Insights:</strong></p>
                        <ul class="mb-0">
                            <li>Focus on ${sport === 'NFL' ? 'high-volume RBs with 20+ touches' : 'pace-up guards in fast games'}</li>
                            <li>Stack ${sport === 'NFL' ? 'QB-WR from games 47+ total' : 'teammates in blowout spots'}</li>
                            <li>Leverage low ownership on elite plays (under 15%)</li>
                            <li>Weather concern: ${sport === 'NFL' ? 'BUF@MIA wind 15+ mph' : 'No weather factors'}</li>
                        </ul>
                    </div>
                `,
          gemini: `
                    <div class="ai-analysis">
                        <h6><i class="fas fa-star me-2" style="color: #4285f4;"></i>Gemini Analysis</h6>
                        <p><strong>Strategic Recommendations:</strong></p>
                        <ul class="mb-0">
                            <li>Contrarian build: Fade chalk, target 8-12% owned studs</li>
                            <li>Correlation stacks: Primary + secondary with bring-back</li>
                            <li>Value tier: Mid-range with ceiling upside</li>
                            <li>Tournament strategy: Risk/reward optimization</li>
                        </ul>
                    </div>
                `,
          deepseek: `
                    <div class="ai-analysis">
                        <h6><i class="fas fa-eye me-2" style="color: #1976d2;"></i>DeepSeek Analysis</h6>
                        <p><strong>Advanced Strategy:</strong></p>
                        <ul class="mb-0">
                            <li>Exploit ownership inefficiencies: Target 60%+ floor plays</li>
                            <li>Multi-layer stacking: Primary correlation + game environment</li>
                            <li>Salary allocation: 40% studs, 35% value, 25% punts</li>
                            <li>Leverage spots: Low-owned players in elite matchups</li>
                        </ul>
                    </div>
                `,
        };

        setTimeout(() => {
          $('#aiResponseArea').html(analyses[provider]);
          hideLoading();
          showAlert(
            'success',
            `${provider.toUpperCase()} multi-source analysis complete!`
          );
        }, 1500);
      }

      function optimizeWithLiveData() {
        if (enhancedState.players.length === 0) {
          showAlert('warning', 'Load live slate data first');
          return;
        }

        const numLineups = parseInt($('#numLineups').val());
        const strategy = $('#strategy').val();

        showLoading(`Optimizing ${numLineups} lineups with live multi-source data...`);

        setTimeout(() => {
          const lineups = generateEnhancedLineups(numLineups, strategy);
          enhancedState.lineups = lineups;
          displayEnhancedLineups(lineups);

          hideLoading();
          showAlert(
            'success',
            `‚úÖ Generated ${lineups.length} lineups using live data from 7 sources!`
          );
        }, 2000);
      }

      function generateEnhancedLineups(count, strategy) {
        const lineups = [];

        for (let i = 0; i < count; i++) {
          const availablePlayers = enhancedState.players.filter(p => !p.banned);

          // Strategy-based selection
          let selectedPlayers;
          if (strategy === 'cash') {
            // Cash game: high floor, safe plays
            selectedPlayers = availablePlayers
              .sort(
                (a, b) =>
                  b.consensus_projection / (b.salary / 1000) -
                  a.consensus_projection / (a.salary / 1000)
              )
              .slice(0, enhancedState.sport === 'NFL' ? 6 : 5);
          } else if (strategy === 'gpp') {
            // Tournament: ceiling plays, contrarian
            selectedPlayers = availablePlayers
              .filter(p => p.rg_ownership < 20) // Low owned
              .sort((a, b) => b.value - a.value)
              .slice(0, enhancedState.sport === 'NFL' ? 6 : 5);
          } else {
            // Hybrid: balanced approach
            selectedPlayers = availablePlayers
              .sort((a, b) => b.consensus_projection - a.consensus_projection)
              .slice(0, enhancedState.sport === 'NFL' ? 6 : 5);
          }

          const totalSalary = selectedPlayers.reduce((sum, p) => sum + p.salary, 0);
          const totalProjection = selectedPlayers.reduce(
            (sum, p) => sum + p.consensus_projection,
            0
          );
          const avgOwnership =
            selectedPlayers.reduce((sum, p) => sum + p.rg_ownership, 0) /
            selectedPlayers.length;
          const salaryCap = enhancedState.site === 'DraftKings' ? 50000 : 60000;

          lineups.push({
            id: `enhanced_lineup_${i + 1}`,
            players: selectedPlayers,
            total_salary: totalSalary,
            total_projection: Math.round(totalProjection * 10) / 10,
            salary_remaining: salaryCap - totalSalary,
            avg_ownership: Math.round(avgOwnership * 10) / 10,
            strategy: strategy,
            sources_used: 7,
          });
        }

        return lineups;
      }

      function displayEnhancedLineups(lineups) {
        const container = $('#enhancedLineupsContainer');
        container.empty();

        lineups.forEach((lineup, index) => {
          const strategyColor =
            lineup.strategy === 'cash'
              ? 'var(--secondary)'
              : lineup.strategy === 'gpp'
                ? 'var(--accent)'
                : 'var(--primary)';

          const lineupCard = $(`
                    <div class="card mb-3" style="border-left: 4px solid ${strategyColor};">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><strong>Enhanced Lineup ${index + 1}</strong> <span class="badge" style="background: ${strategyColor}; color: white;">${lineup.strategy.toUpperCase()}</span></span>
                            <div>
                                <span class="badge bg-success me-2">${lineup.total_projection} pts</span>
                                <span class="badge bg-primary me-2">$${lineup.salary_remaining.toLocaleString()} left</span>
                                <span class="badge bg-info">${lineup.avg_ownership}% avg own</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                ${lineup.players
                                  .map(
                                    player => `
                                    <div class="col-md-6 mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span><strong>${player.name}</strong> (${player.position})</span>
                                            <span>$${(player.salary / 1000).toFixed(0)}K</span>
                                        </div>
                                        <small class="text-muted">Proj: ${player.consensus_projection} | Own: ${player.rg_ownership}% | PFF: ${player.pff_grade}</small>
                                    </div>
                                `
                                  )
                                  .join('')}
                            </div>
                            <div class="mt-2 p-2 bg-light rounded">
                                <small><i class="fas fa-info-circle me-1"></i><strong>Multi-Source Data:</strong> ${lineup.sources_used} sources used for optimization</small>
                            </div>
                        </div>
                    </div>
                `);

          container.append(lineupCard);
        });
      }

      function togglePlayerLock(playerId) {
        const player = enhancedState.players.find(p => p.id === playerId);
        if (player) {
          player.locked = !player.locked;
          if (player.locked) player.banned = false;
          displayEnhancedPlayers(enhancedState.players);
        }
      }

      function togglePlayerBan(playerId) {
        const player = enhancedState.players.find(p => p.id === playerId);
        if (player) {
          player.banned = !player.banned;
          if (player.banned) player.locked = false;
          displayEnhancedPlayers(enhancedState.players);
        }
      }

      function showPlayerAnalysis(playerId) {
        const player = enhancedState.players.find(p => p.id === playerId);
        if (player) {
          const analysis = `
                    <div class="player-analysis">
                        <h6>${player.name} Multi-Source Analysis</h6>
                        <div class="row">
                            <div class="col-6">
                                <strong>Projections:</strong><br>
                                RG: ${player.rg_projection}<br>
                                SaberSim: ${player.sabersim_projection}<br>
                                Stokastic: ${player.stokastic_projection}
                            </div>
                            <div class="col-6">
                                <strong>Metrics:</strong><br>
                                PFF Grade: ${player.pff_grade}<br>
                                Target Share: ${player.target_share}%<br>
                                Snap Count: ${player.snap_count}
                            </div>
                        </div>
                    </div>
                `;

          showAlert('info', analysis);
        }
      }

      function exportEnhancedLineups() {
        if (enhancedState.lineups.length === 0) {
          showAlert('warning', 'Generate lineups first');
          return;
        }

        // Create enhanced CSV with multi-source data
        showAlert(
          'success',
          `üìä Exported ${enhancedState.lineups.length} enhanced lineups with multi-source projections!`
        );
      }

      function showAlert(type, message) {
        const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        $('#alertArea').html(alertHtml);
        setTimeout(() => $('.alert').alert('close'), 8000);
      }

      function showLoading(message) {
        const loadingHtml = `
                <div class="alert alert-info d-flex align-items-center" id="loadingAlert">
                    <div class="spinner-border text-info me-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div>${message}</div>
                </div>
            `;
        $('#alertArea').html(loadingHtml);
      }

      function hideLoading() {
        $('#loadingAlert').remove();
      }
    </script>
  </body>
</html>
