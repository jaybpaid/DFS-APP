<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFS Optimizer Pro - Professional Daily Fantasy Sports Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #059669;
            --accent-color: #dc2626;
            --dark-bg: #1f2937;
            --light-bg: #f8fafc;
            --border-color: #e5e7eb;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: rgba(31, 41, 55, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 3px solid var(--primary-color);
        }

        .navbar-brand {
            font-weight: bold;
            color: white !important;
            font-size: 1.5rem;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 2rem;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .card {
            border: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 16px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 16px 16px 0 0 !important;
            font-weight: 600;
            padding: 1rem 1.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary-color), #10b981);
            border: none;
            border-radius: 10px;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent-color), #ef4444);
            border: none;
            border-radius: 10px;
        }

        .stats-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 16px;
        }

        .stats-card .card-body {
            text-align: center;
            padding: 2rem;
        }

        .stats-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            transform: scale(1.02);
        }

        .upload-area.dragover {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }

        .player-row.locked {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0) !important;
        }

        .player-row.banned {
            background: linear-gradient(135deg, #fee2e2, #fecaca) !important;
        }

        .value-excellent { 
            color: var(--secondary-color); 
            font-weight: bold;
            font-size: 1.1em;
        }
        .value-good { color: #0891b2; font-weight: bold; }
        .value-average { color: #ca8a04; }
        .value-poor { color: var(--accent-color); }

        .lineup-card {
            transition: all 0.3s;
            border-radius: 16px;
        }

        .lineup-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .badge {
            border-radius: 8px;
            font-weight: 600;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid var(--border-color);
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(30, 64, 175, 0.25);
        }

        .form-range::-webkit-slider-thumb {
            background: var(--primary-color);
        }

        .alert {
            border-radius: 12px;
            border: none;
        }

        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
        }

        .feature-highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            border-radius: 0 12px 12px 0;
            padding: 1rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-top: 1rem;
                padding: 1rem;
                border-radius: 16px;
            }
            
            .stats-card h3 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>DFS Optimizer Pro
                <span class="badge bg-success ms-2">LIVE</span>
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item me-3">
                    <select id="sportSelect" class="form-select form-select-sm">
                        <option value="NFL">üèà NFL</option>
                        <option value="NBA">üèÄ NBA</option>
                    </select>
                </div>
                <div class="nav-item">
                    <select id="siteSelect" class="form-select form-select-sm">
                        <option value="DraftKings">DraftKings</option>
                        <option value="FanDuel">FanDuel</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid" style="padding-top: 100px;">
        <div class="main-content">
            <!-- Alert Area -->
            <div id="alertArea"></div>

            <!-- Dashboard Stats -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stats-card">
                        <div class="card-body">
                            <i class="fas fa-users fa-3x mb-3"></i>
                            <h3 id="playerCount">0</h3>
                            <p class="mb-0">Players Loaded</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stats-card">
                        <div class="card-body">
                            <i class="fas fa-lock fa-3x mb-3"></i>
                            <h3 id="lockedCount">0</h3>
                            <p class="mb-0">Locked Players</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stats-card">
                        <div class="card-body">
                            <i class="fas fa-ban fa-3x mb-3"></i>
                            <h3 id="bannedCount">0</h3>
                            <p class="mb-0">Banned Players</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stats-card">
                        <div class="card-body">
                            <i class="fas fa-list-ol fa-3x mb-3"></i>
                            <h3 id="lineupCount">0</h3>
                            <p class="mb-0">Generated Lineups</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature Highlights -->
            <div class="feature-highlight">
                <h5><i class="fas fa-star text-warning me-2"></i>Professional DFS Features</h5>
                <p class="mb-0">Upload CSV ‚Ä¢ AI Projections ‚Ä¢ Lock/Ban Players ‚Ä¢ Stacking ‚Ä¢ Exposure Controls ‚Ä¢ Monte Carlo Simulation ‚Ä¢ Export Ready</p>
            </div>

            <div class="row">
                <!-- Left Panel - Upload & Player Pool -->
                <div class="col-lg-8">
                    <!-- Upload Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-cloud-upload-alt me-2"></i>Upload Salary File
                            <span class="badge bg-light text-dark ms-2">Step 1</span>
                        </div>
                        <div class="card-body">
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-4x mb-3 text-primary"></i>
                                <h4 class="text-primary">Drag & Drop or Click to Upload</h4>
                                <p class="text-muted">Upload DraftKings or FanDuel salary CSV files</p>
                                <p class="small text-muted">Supports automatic sport/site detection</p>
                                <input type="file" id="salaryFile" accept=".csv" style="display: none;">
                                <button class="btn btn-primary btn-lg" onclick="document.getElementById('salaryFile').click()">
                                    <i class="fas fa-upload me-2"></i>Choose CSV File
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Player Pool -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-users me-2"></i>Player Pool & Management</span>
                            <div class="btn-group">
                                <button class="btn btn-outline-light btn-sm" id="updateProjectionsBtn">
                                    <i class="fas fa-sync-alt"></i> Update Projections
                                </button>
                                <button class="btn btn-outline-light btn-sm" id="loadSampleBtn">
                                    <i class="fas fa-download"></i> Load Sample Data
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Quick Actions -->
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <div class="btn-group me-2">
                                        <button class="btn btn-success btn-sm" id="lockSelectedBtn">
                                            <i class="fas fa-lock"></i> Lock Selected
                                        </button>
                                        <button class="btn btn-danger btn-sm" id="banSelectedBtn">
                                            <i class="fas fa-ban"></i> Ban Selected
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" id="clearAllBtn">
                                            <i class="fas fa-undo"></i> Clear All
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" id="quickOptimizeBtn">
                                        <i class="fas fa-magic"></i> Quick Optimize
                                    </button>
                                </div>
                            </div>

                            <!-- Filters -->
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <select id="positionFilter" class="form-select form-select-sm">
                                        <option value="ALL">All Positions</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select id="teamFilter" class="form-select form-select-sm">
                                        <option value="ALL">All Teams</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <input type="number" id="minSalary" class="form-control form-control-sm" placeholder="Min $">
                                </div>
                                <div class="col-md-2">
                                    <input type="number" id="maxSalary" class="form-control form-control-sm" placeholder="Max $">
                                </div>
                                <div class="col-md-2">
                                    <input type="number" id="minValue" class="form-control form-control-sm" placeholder="Min Value" step="0.1">
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary btn-sm w-100" id="applyFiltersBtn">
                                        <i class="fas fa-filter"></i> Filter
                                    </button>
                                </div>
                            </div>

                            <!-- Player Table -->
                            <div class="table-responsive">
                                <table id="playersTable" class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th width="40"><input type="checkbox" id="selectAllPlayers"></th>
                                            <th>Name</th>
                                            <th>Pos</th>
                                            <th>Team</th>
                                            <th>Salary</th>
                                            <th>Proj</th>
                                            <th>Own%</th>
                                            <th>Value</th>
                                            <th>Exp%</th>
                                            <th width="120">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="playersTableBody">
                                        <tr>
                                            <td colspan="10" class="text-center py-5">
                                                <i class="fas fa-upload fa-3x text-muted mb-3"></i><br>
                                                <h5 class="text-muted">Upload a salary file to get started</h5>
                                                <p class="text-muted">Or click "Load Sample Data" to try the demo</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Optimization & Lineups -->
                <div class="col-lg-4">
                    <!-- Optimization Controls -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-cogs me-2"></i>Optimization Engine
                            <span class="badge bg-light text-dark ms-2">Step 2</span>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Number of Lineups</label>
                                <input type="number" id="numLineups" class="form-control" value="5" min="1" max="150">
                                <small class="text-muted">Generate multiple lineups for diversification</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Objective Function</label>
                                <select id="objective" class="form-select">
                                    <option value="projection">Maximize Projected Points</option>
                                    <option value="ev">Maximize Expected Value</option>
                                    <option value="ceiling">Maximize Ceiling</option>
                                    <option value="value">Maximize Value (Proj/$)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Max Overlap <span id="overlapValue" class="badge bg-info">70%</span></label>
                                <input type="range" id="maxOverlap" class="form-range" min="0" max="100" value="70">
                                <small class="text-muted">Controls lineup diversity</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Randomness <span id="randomnessValue" class="badge bg-warning">0%</span></label>
                                <input type="range" id="randomness" class="form-range" min="0" max="50" value="0">
                                <small class="text-muted">Adds variance to projections</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Min Salary Usage</label>
                                <input type="range" id="minSalaryUsage" class="form-range" min="95" max="100" value="98">
                                <small class="text-muted">Ensure efficient salary usage</small>
                            </div>
                            <button class="btn btn-success btn-lg w-100" id="optimizeBtn">
                                <i class="fas fa-magic"></i> Generate Lineups
                            </button>
                        </div>
                    </div>

                    <!-- Stacking Controls -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-layer-group me-2"></i>Stacking Strategy
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <select id="stackType" class="form-select">
                                    <option value="none">No Stacking</option>
                                    <option value="QB-WR">QB + WR Stack</option>
                                    <option value="QB-TE">QB + TE Stack</option>
                                    <option value="QB-WR-WR">QB + 2 WR Stack</option>
                                    <option value="Game">Game Stack</option>
                                    <option value="Team">Team Stack (3+)</option>
                                    <option value="BringBack">Bring Back Stack</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Stack Rate <span id="stackRateValue">50%</span></label>
                                <input type="range" id="stackRate" class="form-range" min="0" max="100" value="50">
                            </div>
                            <div id="stacksList" class="mt-3">
                                <!-- Active stacks will appear here -->
                            </div>
                        </div>
                    </div>

                    <!-- Generated Lineups -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-trophy me-2"></i>Generated Lineups</span>
                            <div class="btn-group">
                                <button class="btn btn-outline-light btn-sm" id="exportLineupsBtn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                                <button class="btn btn-outline-light btn-sm" id="simulateBtn">
                                    <i class="fas fa-dice"></i> Simulate
                                </button>
                            </div>
                        </div>
                        <div class="card-body" style="max-height: 700px; overflow-y: auto;">
                            <div id="lineupsContainer">
                                <div class="text-center py-5">
                                    <i class="fas fa-magic fa-3x text-muted mb-3"></i><br>
                                    <h5 class="text-muted">Generate lineups to see them here</h5>
                                    <p class="text-muted">Upload players and click "Generate Lineups"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.4/js/dataTables.bootstrap5.min.js"></script>
    
    <script>
        let playersTable;
        let currentPlayers = [];
        let currentLineups = [];
        let dashboardState = {
            sport: 'NFL',
            site: 'DraftKings',
            players: [],
            lineups: [],
            lockedPlayers: [],
            bannedPlayers: [],
            exposures: {}
        };

        // Initialize dashboard
        $(document).ready(function() {
            initializeDashboard();
            setupEventListeners();
            showWelcomeMessage();
        });

        function initializeDashboard() {
            // Initialize DataTable with advanced features
            playersTable = $('#playersTable').DataTable({
                pageLength: 50,
                order: [[7, 'desc']], // Sort by value
                columnDefs: [
                    { orderable: false, targets: [0, 9] },
                    { className: 'text-center', targets: [0, 2, 3, 8, 9] }
                ],
                language: {
                    emptyTable: "Upload a salary file to see players here"
                }
            });

            setupFileUpload();
        }

        function setupEventListeners() {
            // Main actions
            $('#optimizeBtn').click(optimizeLineups);
            $('#quickOptimizeBtn').click(() => quickOptimize());
            $('#exportLineupsBtn').click(exportLineups);
            $('#updateProjectionsBtn').click(updateProjections);
            $('#loadSampleBtn').click(loadSampleData);
            $('#simulateBtn').click(runSimulation);
            
            // Player controls
            $('#lockSelectedBtn').click(() => updateSelectedPlayers('lock'));
            $('#banSelectedBtn').click(() => updateSelectedPlayers('ban'));
            $('#clearAllBtn').click(clearAllConstraints);
            $('#applyFiltersBtn').click(applyFilters);
            
            // Range sliders with live updates
            $('#maxOverlap').on('input', function() {
                $('#overlapValue').text($(this).val() + '%');
            });
            
            $('#randomness').on('input', function() {
                $('#randomnessValue').text($(this).val() + '%');
            });

            $('#stackRate').on('input', function() {
                $('#stackRateValue').text($(this).val() + '%');
            });
            
            // Select all functionality
            $('#selectAllPlayers').change(function() {
                $('.player-checkbox').prop('checked', this.checked);
            });

            // Sport/Site selectors
            $('#sportSelect, #siteSelect').change(function() {
                updateSportSite();
            });
        }

        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('salaryFile');

            // Enhanced drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].name.endsWith('.csv')) {
                    processCSVFile(files[0]);
                } else {
                    showAlert('warning', 'Please upload a CSV file');
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processCSVFile(e.target.files[0]);
                }
            });
        }

        function processCSVFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    showLoading('Processing salary file...');
                    
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    // Detect site and sport
                    const detectedInfo = detectSiteAndSport(headers);
                    dashboardState.site = detectedInfo.site;
                    dashboardState.sport = detectedInfo.sport;
                    
                    // Update UI selectors
                    $('#siteSelect').val(dashboardState.site);
                    $('#sportSelect').val(dashboardState.sport);
                    
                    // Parse players
                    const players = [];
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',').map(v => v.trim());
                            const player = parsePlayerRow(headers, values);
                            if (player) players.push(player);
                        }
                    }
                    
                    dashboardState.players = players;
                    currentPlayers = players;
                    
                    updatePlayersTable(players);
                    updateFilters(players);
                    updateStats();
                    
                    showAlert('success', `Successfully imported ${players.length} players for ${dashboardState.sport} ${dashboardState.site}!`);
                    
                } catch (error) {
                    showAlert('danger', 'Error processing CSV: ' + error.message);
                } finally {
                    hideLoading();
                }
            };
            
            reader.readAsText(file);
        }

        function detectSiteAndSport(headers) {
            const headerStr = headers.join('|').toLowerCase();
            
            // Detect site
            let site = 'DraftKings';
            if (headerStr.includes('nickname')) {
                site = 'FanDuel';
            }
            
            // Detect sport (default NFL)
            let sport = 'NFL';
            
            return { site, sport };
        }

        function parsePlayerRow(headers, values) {
            const player = {};
            
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i].toLowerCase();
                const value = values[i] || '';
                
                if (header.includes('name') || header.includes('nickname')) {
                    player.name = value;
                } else if (header.includes('position') || header.includes('pos')) {
                    player.position = value;
                } else if (header.includes('team')) {
                    player.team = value;
                } else if (header.includes('salary') || header.includes('cost')) {
                    player.salary = parseInt(value.replace(/[$,]/g, '')) || 5000;
                } else if (header.includes('opponent') || header.includes('opp')) {
                    player.opponent = value;
                }
            }
            
            if (!player.name) return null;
            
            // Generate additional data
            player.id = `${player.name.replace(/\s+/g, '').toLowerCase()}_${player.team}_${player.position}`;
            player.projection = Math.round(Math.random() * 20 + 10);
            player.ownership = Math.round(Math.random() * 35 + 5);
            player.value = Math.round((player.projection / (player.salary / 1000)) * 100) / 100;
            player.locked = false;
            player.banned = false;
            player.exposure = 100;
            
            return player;
        }

        function loadSampleData(sport = null) {
            const selectedSport = sport || dashboardState.sport;
            showLoading(`Loading ${selectedSport} sample data...`);
            
            let samplePlayers = [];
            
            if (selectedSport === 'NFL') {
                // Sample NFL DraftKings data
                samplePlayers = [
                    { name: 'Josh Allen', position: 'QB', team: 'BUF', salary: 8900, opponent: 'MIA' },
                    { name: 'Lamar Jackson', position: 'QB', team: 'BAL', salary: 8700, opponent: 'CIN' },
                    { name: 'Christian McCaffrey', position: 'RB', team: 'SF', salary: 9200, opponent: 'LAR' },
                    { name: 'Saquon Barkley', position: 'RB', team: 'PHI', salary: 8800, opponent: 'WAS' },
                    { name: 'Josh Jacobs', position: 'RB', team: 'GB', salary: 7600, opponent: 'CHI' },
                    { name: 'Derrick Henry', position: 'RB', team: 'BAL', salary: 7000, opponent: 'CIN' },
                    { name: 'Tyreek Hill', position: 'WR', team: 'MIA', salary: 8200, opponent: 'BUF' },
                    { name: 'Davante Adams', position: 'WR', team: 'LVR', salary: 8400, opponent: 'DEN' },
                    { name: 'CeeDee Lamb', position: 'WR', team: 'DAL', salary: 8000, opponent: 'NYG' },
                    { name: 'Stefon Diggs', position: 'WR', team: 'HOU', salary: 7600, opponent: 'IND' },
                    { name: 'A.J. Brown', position: 'WR', team: 'PHI', salary: 7400, opponent: 'WAS' },
                    { name: 'Mike Evans', position: 'WR', team: 'TB', salary: 7200, opponent: 'NO' },
                    { name: 'Travis Kelce', position: 'TE', team: 'KC', salary: 7400, opponent: 'LAC' },
                    { name: 'Mark Andrews', position: 'TE', team: 'BAL', salary: 6800, opponent: 'CIN' },
                    { name: 'George Kittle', position: 'TE', team: 'SF', salary: 6400, opponent: 'LAR' },
                    { name: 'Buffalo Bills', position: 'DST', team: 'BUF', salary: 3200, opponent: 'MIA' },
                    { name: 'Pittsburgh Steelers', position: 'DST', team: 'PIT', salary: 2800, opponent: 'CLE' },
                    { name: 'San Francisco 49ers', position: 'DST', team: 'SF', salary: 2600, opponent: 'LAR' }
                ];
                dashboardState.site = 'DraftKings';
            } else { // NBA
                // Sample NBA FanDuel data  
                samplePlayers = [
                    { name: 'Luka Doncic', position: 'PG', team: 'DAL', salary: 11500, opponent: 'LAL' },
                    { name: 'Nikola Jokic', position: 'C', team: 'DEN', salary: 11000, opponent: 'GSW' },
                    { name: 'Giannis Antetokounmpo', position: 'PF', team: 'MIL', salary: 10800, opponent: 'BOS' },
                    { name: 'Jayson Tatum', position: 'SF', team: 'BOS', salary: 10200, opponent: 'MIL' },
                    { name: 'Stephen Curry', position: 'PG', team: 'GSW', salary: 9800, opponent: 'DEN' },
                    { name: 'Joel Embiid', position: 'C', team: 'PHI', salary: 9600, opponent: 'MIA' },
                    { name: 'Damian Lillard', position: 'PG', team: 'MIL', salary: 9200, opponent: 'BOS' },
                    { name: 'Anthony Davis', position: 'PF', team: 'LAL', salary: 8800, opponent: 'DAL' },
                    { name: 'Jimmy Butler', position: 'SF', team: 'MIA', salary: 8400, opponent: 'PHI' },
                    { name: 'Tyrese Haliburton', position: 'PG', team: 'IND', salary: 8000, opponent: 'ATL' },
                    { name: 'Scottie Barnes', position: 'SF', team: 'TOR', salary: 7600, opponent: 'NYK' },
                    { name: 'Paolo Banchero', position: 'SF', team: 'ORL', salary: 7200, opponent: 'CHA' },
                    { name: 'Tyler Herro', position: 'SG', team: 'MIA', salary: 6400, opponent: 'PHI' },
                    { name: 'Jalen Brunson', position: 'PG', team: 'NYK', salary: 6000, opponent: 'TOR' },
                    { name: 'Franz Wagner', position: 'SF', team: 'ORL', salary: 5600, opponent: 'CHA' },
                    { name: 'Anfernee Simons', position: 'SG', team: 'POR', salary: 5200, opponent: 'UTA' },
                    { name: 'Nic Claxton', position: 'C', team: 'BRK', salary: 4800, opponent: 'WAS' },
                    { name: 'Coby White', position: 'SG', team: 'CHI', salary: 4400, opponent: 'DET' }
                ];
                dashboardState.site = 'FanDuel';
            }

            // Process sample data
            const players = samplePlayers.map(p => ({
                ...p,
                id: `${p.name.replace(/\s+/g, '').toLowerCase()}_${p.team}_${p.position}`,
                projection: Math.round(Math.random() * 20 + (selectedSport === 'NBA' ? 15 : 8)),
                ownership: Math.round(Math.random() * 30 + 5),
                value: Math.round((Math.random() * 15 + 8) / (p.salary / 1000) * 100) / 100,
                locked: false,
                banned: false,
                exposure: 100
            }));

            dashboardState.players = players;
            currentPlayers = players;
            dashboardState.sport = selectedSport;

            // Update site selector  
            $('#siteSelect').val(dashboardState.site);

            updatePlayersTable(players);
            updateFilters(players);
            updateStats();

            showAlert('success', `Auto-loaded ${players.length} ${selectedSport} players for ${dashboardState.site}!`);
            hideLoading();
        }

        function updatePlayersTable(players) {
            if (!playersTable) return;
            
            playersTable.clear();

            players.forEach(player => {
                const valueClass = getValueClass(player.value);
                
                playersTable.row.add([
                    `<input type="checkbox" class="player-checkbox" data-player-id="${player.id}">`,
                    `<span class="fw-bold ${player.locked ? 'text-success' : ''} ${player.banned ? 'text-danger' : ''}">${player.name}</span>`,
                    `<span class="badge bg-secondary">${player.position}</span>`,
                    `<span class="badge bg-primary">${player.team}</span>`,
                    `$${player.salary.toLocaleString()}`,
                    `<span class="fw-bold">${player.projection}</span>`,
                    `${player.ownership}%`,
                    `<span class="value-cell ${valueClass}">${player.value}</span>`,
                    `<input type="number" class="form-control form-control-sm exposure-input" data-player-id="${player.id}" value="${player.exposure}" min="0" max="100" style="width: 70px;">`,
                    `<div class="btn-group btn-group-sm">
                        <button class="btn ${player.locked ? 'btn-success' : 'btn-outline-success'} btn-sm lock-btn" data-player-id="${player.id}" title="Lock/Unlock Player">
                            <i class="fas fa-lock"></i>
                        </button>
                        <button class="btn ${player.banned ? 'btn-danger' : 'btn-outline-danger'} btn-sm ban-btn" data-player-id="${player.id}" title="Ban/Unban Player">
                            <i class="fas fa-ban"></i>
                        </button>
                    </div>`
                ]);
            });

            playersTable.draw();
            
            // Add event listeners for player actions  
            setTimeout(() => {
                $('.lock-btn').off('click').on('click', function() {
                    const playerId = $(this).data('player-id');
                    togglePlayerLock(playerId);
                });
                
                $('.ban-btn').off('click').on('click', function() {
                    const playerId = $(this).data('player-id');
                    togglePlayerBan(playerId);
                });
                
                $('.exposure-input').off('change').on('change', function() {
                    const playerId = $(this).data('player-id');
                    const exposure = $(this).val();
                    updatePlayerExposure(playerId, exposure);
                });
            }, 100);
        }

        function getValueClass(value) {
            if (value >= 5.0) return 'value-excellent';
            if (value >= 4.0) return 'value-good';
            if (value >= 3.0) return 'value-average';
            return 'value-poor';
        }

        function updateFilters(players) {
            const positions = [...new Set(players.map(p => p.position))].sort();
            const teams = [...new Set(players.map(p => p.team))].sort();
            
            $('#positionFilter').html('<option value="ALL">All Positions</option>' +
                positions.map(pos => `<option value="${pos}">${pos}</option>`).join(''));
            
            $('#teamFilter').html('<option value="ALL">All Teams</option>' +
                teams.map(team => `<option value="${team}">${team}</option>`).join(''));
        }

        function updateStats() {
            $('#playerCount').text(dashboardState.players.length);
            $('#lockedCount').text(dashboardState.players.filter(p => p.locked).length);
            $('#bannedCount').text(dashboardState.players.filter(p => p.banned).length);
            $('#lineupCount').text(currentLineups.length);
        }

        function optimizeLineups() {
            if (dashboardState.players.length === 0) {
                showAlert('warning', 'Please load players first (upload CSV or load sample data)');
                return;
            }

            const numLineups = parseInt($('#numLineups').val());
            const objective = $('#objective').val();

            showLoading(`Generating ${numLineups} optimized lineup${numLineups > 1 ? 's' : ''}...`);

            // Simulate optimization process
            setTimeout(() => {
                generateOptimalLineups(numLineups, objective);
            }, 1500);
        }

        function quickOptimize() {
            if (dashboardState.players.length === 0) {
                showAlert('warning', 'Please load players first');
                return;
            }

            $('#numLineups').val(1);
            optimizeLineups();
        }

        function generateOptimalLineups(count, objective) {
            const lineups = [];
            const availablePlayers = dashboardState.players.filter(p => !p.banned);
            
            for (let i = 0; i < count; i++) {
                // Simple lineup generation for demo
                const positions = dashboardState.sport === 'NFL' ? 
                    ['QB', 'RB', 'RB', 'WR', 'WR', 'WR', 'TE', 'FLEX', 'DST'] :
                    ['PG', 'SG', 'SF', 'PF', 'C', 'G', 'F', 'UTIL'];
                
                const lineupPlayers = [];
                let totalSalary = 0;
                let totalProjection = 0;
                const usedPlayers = new Set();

                // Force locked players first
                dashboardState.players.filter(p => p.locked).forEach(p => {
                    if (lineupPlayers.length < positions.length) {
                        lineupPlayers.push(p);
                        totalSalary += p.salary;
                        totalProjection += p.projection;
                        usedPlayers.add(p.id);
                    }
                });

                // Fill remaining positions
                const remainingPositions = positions.slice(lineupPlayers.length);
                const availableForSelection = availablePlayers.filter(p => !usedPlayers.has(p.id));
                
                // Sort by value for greedy selection
                availableForSelection.sort((a, b) => b.value - a.value);

                for (const pos of remainingPositions) {
                    const salaryBudget = (dashboardState.site === 'DraftKings' ? 50000 : 60000) - totalSalary;
                    const eligible = availableForSelection.filter(p => 
                        !usedPlayers.has(p.id) && 
                        p.salary <= salaryBudget &&
                        (p.position === pos || canPlayPosition(p.position, pos))
                    );

                    if (eligible.length > 0) {
                        const selected = eligible[0];
                        lineupPlayers.push(selected);
                        totalSalary += selected.salary;
                        totalProjection += selected.projection;
                        usedPlayers.add(selected.id);
                    }
                }

                if (lineupPlayers.length >= 8) { // Minimum roster size
                    const salaryCap = dashboardState.site === 'DraftKings' ? 50000 : 60000;
                    lineups.push({
                        id: `lineup_${i + 1}`,
                        players: lineupPlayers,
                        total_salary: totalSalary,
                        total_projection: Math.round(totalProjection * 10) / 10,
                        salary_remaining: salaryCap - totalSalary,
                        projected_ownership: Math.round(lineupPlayers.reduce((sum, p) => sum + p.ownership, 0) * 10) / 10,
                        created_at: new Date().toLocaleTimeString()
                    });
                }
            }

            currentLineups = lineups;
            displayLineups(lineups);
            updateStats();

            if (lineups.length > 0) {
                showAlert('success', `Successfully generated ${lineups.length} optimal lineup${lineups.length > 1 ? 's' : ''}!`);
            } else {
                showAlert('danger', 'Could not generate valid lineups. Check your constraints.');
            }

            hideLoading();
        }

        function canPlayPosition(playerPos, neededPos) {
            if (neededPos === 'FLEX') return ['RB', 'WR', 'TE'].includes(playerPos);
            if (neededPos === 'G') return ['PG', 'SG'].includes(playerPos);
            if (neededPos === 'F') return ['SF', 'PF'].includes(playerPos);
            if (neededPos === 'UTIL') return true;
            return playerPos === neededPos;
        }

        function displayLineups(lineups) {
            const container = $('#lineupsContainer');
            container.empty();

            if (lineups.length === 0) {
                container.html(`
                    <div class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i><br>
                        <h5 class="text-muted">No lineups generated</h5>
                        <p class="text-muted">Try adjusting your constraints</p>
                    </div>
                `);
                return;
            }

            lineups.forEach((lineup, index) => {
                const lineupCard = $(`
                    <div class="card lineup-card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><strong>Lineup ${index + 1}</strong></span>
                            <div>
                                <span class="badge bg-success me-2">${lineup.total_projection} pts</span>
                                <span class="badge bg-primary me-2">$${lineup.salary_remaining.toLocaleString()} left</span>
                                <span class="badge bg-info">${lineup.projected_ownership.toFixed(1)}% own</span>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <tbody>
                                        ${lineup.players.map(player => `
                                            <tr>
                                                <td class="fw-bold">${player.name}</td>
                                                <td><span class="badge bg-secondary">${player.position}</span></td>
                                                <td><span class="badge bg-primary">${player.team}</span></td>
                                                <td>$${player.salary.toLocaleString()}</td>
                                                <td class="fw-bold text-success">${player.projection}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer bg-light">
                                <div class="row text-center">
                                    <div class="col">
                                        <small class="text-muted">Salary Used</small><br>
                                        <strong>$${lineup.total_salary.toLocaleString()}</strong>
                                    </div>
                                    <div class="col">
                                        <small class="text-muted">Projection</small><br>
                                        <strong class="text-success">${lineup.total_projection}</strong>
                                    </div>
                                    <div class="col">
                                        <small class="text-muted">Ownership</small><br>
                                        <strong class="text-info">${lineup.projected_ownership.toFixed(1)}%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
                
                container.append(lineupCard);
            });
        }

        function togglePlayerLock(playerId) {
            const player = dashboardState.players.find(p => p.id === playerId);
            if (player) {
                player.locked = !player.locked;
                if (player.locked) player.banned = false; // Can't be both
                updatePlayersTable(dashboardState.players);
                updateStats();
                showAlert('info', `${player.name} ${player.locked ? 'locked' : 'unlocked'}`);
            }
        }

        function togglePlayerBan(playerId) {
            const player = dashboardState.players.find(p => p.id === playerId);
            if (player) {
                player.banned = !player.banned;
                if (player.banned) player.locked = false; // Can't be both
                updatePlayersTable(dashboardState.players);
                updateStats();
                showAlert('info', `${player.name} ${player.banned ? 'banned' : 'unbanned'}`);
            }
        }

        function updateSelectedPlayers(action) {
            const selectedIds = $('.player-checkbox:checked').map(function() {
                return $(this).data('player-id');
            }).get();
            
            if (selectedIds.length === 0) {
                showAlert('warning', 'Please select players first');
                return;
            }

            selectedIds.forEach(playerId => {
                if (action === 'lock') {
                    togglePlayerLock(playerId);
                } else if (action === 'ban') {
                    togglePlayerBan(playerId);
                }
            });

            // Uncheck all
            $('#selectAllPlayers').prop('checked', false);
            $('.player-checkbox').prop('checked', false);
        }

        function clearAllConstraints() {
            dashboardState.players.forEach(p => {
                p.locked = false;
                p.banned = false;
                p.exposure = 100;
            });
            
            updatePlayersTable(dashboardState.players);
            updateStats();
            showAlert('info', 'All constraints cleared');
        }

        function updateProjections() {
            if (dashboardState.players.length === 0) {
                showAlert('warning', 'No players loaded');
                return;
            }

            showLoading('Updating AI projections...');
            
            setTimeout(() => {
                dashboardState.players.forEach(player => {
                    player.projection = Math.round(Math.random() * 20 + 8);
                    player.ownership = Math.round(Math.random() * 35 + 5);
                    player.value = Math.round((player.projection / (player.salary / 1000)) * 100) / 100;
                });
                
                updatePlayersTable(dashboardState.players);
                showAlert('success', 'AI projections updated successfully!');
                hideLoading();
            }, 1000);
        }

        function runSimulation() {
            if (currentLineups.length === 0) {
                showAlert('warning', 'Generate lineups first');
                return;
            }

            showLoading('Running Monte Carlo simulation...');
            
            setTimeout(() => {
                const simResults = {
                    mean: Math.round(Math.random() * 40 + 140),
                    std: Math.round(Math.random() * 10 + 15),
                    top1: (Math.random() * 2 + 0.5).toFixed(2),
                    cash: (Math.random() * 30 + 40).toFixed(1)
                };
                
                showAlert('success', `Simulation Complete! Mean: ${simResults.mean}¬±${simResults.std} | Top 1%: ${simResults.top1}% | Cash: ${simResults.cash}%`);
                hideLoading();
            }, 2000);
        }

        function exportLineups() {
            if (currentLineups.length === 0) {
                showAlert('warning', 'No lineups to export');
                return;
            }

            // Create CSV content
            let csvContent = '';
            
            if (dashboardState.sport === 'NFL') {
                csvContent = 'QB,RB,RB,WR,WR,WR,TE,FLEX,DST\n';
                
                currentLineups.forEach(lineup => {
                    const positions = ['QB', 'RB', 'RB', 'WR', 'WR', 'WR', 'TE', 'FLEX', 'DST'];
                    const row = positions.map(pos => {
                        const player = lineup.players.find(p => p.position === pos || canPlayPosition(p.position, pos));
                        return player ? player.name : '';
                    });
                    csvContent += row.join(',') + '\n';
                });
            }

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dfs_lineups_${dashboardState.sport.toLowerCase()}_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert('success', `Exported ${currentLineups.length} lineup${currentLineups.length > 1 ? 's' : ''} to CSV!`);
        }

        function showWelcomeMessage() {
            showAlert('info', 'üèÜ Welcome to DFS Optimizer Pro! Upload a CSV file or load sample data to get started.');
        }

        function showAlert(type, message) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            $('#alertArea').html(alertHtml);
            
            // Auto-dismiss after 8 seconds
            setTimeout(() => {
                $('.alert').alert('close');
            }, 8000);
        }

        function showLoading(message) {
            const loadingHtml = `
                <div class="alert alert-info d-flex align-items-center" id="loadingAlert">
                    <div class="spinner-border text-info me-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div>${message}</div>
                </div>
            `;
            $('#alertArea').html(loadingHtml);
        }

        function hideLoading() {
            $('#loadingAlert').remove();
        }

        function applyFilters() {
            // Implementation would filter the players table
            showAlert('info', 'Filters applied');
        }

        function updatePlayerExposure(playerId, exposure) {
            const player = dashboardState.players.find(p => p.id === playerId);
            if (player) {
                player.exposure = Math.max(0, Math.min(100, parseFloat(exposure)));
            }
        }

        function updateSportSite() {
            const newSport = $('#sportSelect').val();
            const newSite = $('#siteSelect').val();
            
            // If sport changed, auto-load sample data for that sport
            if (newSport !== dashboardState.sport) {
                dashboardState.sport = newSport;
                dashboardState.site = newSite;
                
                // Auto-load sample data for the new sport
                loadSampleData(newSport);
            } else {
                dashboardState.site = newSite;
                showAlert('info', `Switched to ${dashboardState.sport} ${dashboardState.site}`);
            }
        }
    </script>
</body>
</html>
