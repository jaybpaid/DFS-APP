# DFS Optimizer Development Commands
# Battle-ready DFS optimizer with sim-first workflow

.PHONY: help mcp-health dev demo test clean install

# Default target
help:
	@echo "DFS Optimizer - Available Commands:"
	@echo ""
	@echo "  make mcp-health    - Check MCP server health"
	@echo "  make install       - Install dependencies"
	@echo "  make dev          - Start development servers"
	@echo "  make demo         - Run end-to-end demo"
	@echo "  make test         - Run all tests"
	@echo "  make clean        - Clean build artifacts"
	@echo ""

# MCP Health Check
mcp-health:
	@echo "ğŸ” Checking MCP server health..."
	@cd .. && ./scripts/healthcheck_mcp.sh

# Install Dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	@pip install -r ../requirements.txt
	@pip install numpy pandas scipy pulp asyncio
	@echo "âœ… Dependencies installed"

# Development Environment
dev:
	@echo "ğŸš€ Starting development environment..."
	@echo "Starting API server..."
	@cd .. && python live_optimizer_api.py &
	@echo "API server started on http://localhost:8000"
	@echo "Opening dashboard..."
	@open ../dfs_ultimate_optimizer_with_live_data.html
	@echo "âœ… Development environment ready"

# Demo Workflow
demo:
	@echo "ğŸ¯ Running end-to-end demo..."
	@echo "Testing simulation engine..."
	@cd services/sim && python model.py
	@echo "Testing optimizer..."
	@cd services/sim && python optimizer.py
	@echo "Testing CSV manager..."
	@cd services/ingest && python csv_manager.py
	@echo "âœ… Demo complete - all systems operational"
	@echo "__CLINE_DONE__ DEMO"

# Test Suite
test:
	@echo "ğŸ§ª Running test suite..."
	@python -m pytest tests/ -v
	@echo "âœ… Tests complete"

# Clean Build Artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@find . -type f -name "*.pyc" -delete
	@find . -type d -name "__pycache__" -delete
	@find . -type d -name "*.egg-info" -exec rm -rf {} +
	@echo "âœ… Clean complete"

# Quick Setup
setup: install mcp-health
	@echo "âœ… Setup complete - ready for development"

# Production Build
build:
	@echo "ğŸ—ï¸  Building for production..."
	@echo "Building web app..."
	@cd apps/web && npm run build
	@echo "Building services..."
	@cd services && python -m compileall .
	@echo "âœ… Build complete"

# Health Check All Services
health:
	@echo "ğŸ¥ Checking all service health..."
	@make mcp-health
	@curl -f http://localhost:8000/health || echo "âŒ API server not running"
	@echo "âœ… Health check complete"
